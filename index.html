<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Ping-Pong Tic-Tac-Toe Game Demo</title>
  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f5f5f5;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      height: 100vh;
    }

h1 {
  margin: 32px 0 12px;   /* 往下移动，增加顶部空间 */
  font-size: 28px;       /* 字体变大 */
  font-weight: 600;       /* 让字更饱满一点，可选 */
}

    .subtitle {
      font-size: 14px;
      color: #555;
      margin-bottom: 12px;
    }

    .stage {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 90%;
      max-width: 1100px;
      flex: 1;
    }

    /* Left / right sides: table + wine glass + ball */
    .side {
      position: relative;
      width: 30%;
      height: 340px;
      display: flex;
      align-items: flex-end;
      justify-content: center;
    }

/* 队伍文字：在杯子和桌面正上方、居中 */
.team-label {
  position: absolute;
  /* 根据需要微调这个高度，让字刚好在杯子上方 */
  bottom: 260px;                 
  left: 50%;
  transform: translateX(-50%);
  font-size: 16px;
  font-weight: 500;
  white-space: nowrap;
}

/* 左边 O 队：蓝色标签 */
.team-left {
  background: #e3f2fd;          /* 淡蓝色底 */
  color: #1565c0;               /* 深蓝字 */
  border: 1px solid #90caf9;    /* 浅蓝边框 */
  padding: 4px 12px;            /* 留一点内边距，像标签 */
  border-radius: 16px;          /* 圆角 */
  font-weight: 700;             /* 比原来更粗一点 */
}

/* 右边 X 队：红色标签 */
.team-right {
  background: #ffebee;          /* 淡红/粉色底 */
  color: #c62828;               /* 深红字 */
  border: 1px solid #ef9a9a;    /* 浅红边框 */
  padding: 4px 12px;
  border-radius: 16px;
  font-weight: 700;
}

    /* 桌子稍微放到后面一点 */
/* 桌子稍微放到后面一点 */
.table {
  width: 80%;
  height: 90px;
  background: #ddd;
  border-radius: 6px;
  position: relative;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  overflow: visible;
  z-index: 1;
  margin: 0 auto;   /* 确保桌子本身居中 */
}

/* 高脚杯：上直线 + 下半圆 + 细长杯脚 + 三角底座 */
/* 高脚杯：上直线 + 下半圆 + 细长杯脚 + 三角底座 */
.glass {
  position: absolute;
  bottom: 90px;               /* 杯肚刚好站在桌面上方 */
  width: 80px;
  height: 90px;
  border: 3px solid #555;
  border-top-left-radius: 4px;
  border-top-right-radius: 4px;
  border-bottom-left-radius: 80px;
  border-bottom-right-radius: 80px;
  background: rgba(255,255,255,0.35);
  display: flex;
  justify-content: center;
  align-items: center;
  overflow: visible;
  z-index: 2;
}

/* 左边：杯子在桌子右侧，和动画中的 left:74% 对齐 */
.side-left .glass {
  left: 74%;
  transform: translateX(-50%);
}

/* 右边：杯子在桌子左侧，和动画中的 right:74% 对齐 */
.side-right .glass {
  right: 74%;
  transform: translateX(50%);
}

/* 杯脚：细长竖线 */
.glass::before {
  content: "";
  position: absolute;
  top: 90px;                    
  left: 50%;
  transform: translateX(-50%);
  width: 4px;
  height: 55px;
  background: #555;
}

/* 底座：扁三角形 */
.glass::after {
  content: "";
  position: absolute;
  top: 145px;                   
  left: 50%;
  transform: translateX(-50%);
  width: 0;
  height: 0;
  border-top: 3px solid #555;
  border-left: 25px solid transparent;
  border-right: 25px solid transparent;
}

/* 空中飞行的球（轨迹动画用的就是这个） */
.ball {
  position: absolute;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: #ffcc00;
  box-shadow: 0 0 6px rgba(0,0,0,0.4);
  display: none;
  z-index: 3;                  /* 确保在杯子和桌子前面，看得到整个轨迹 */
}

/* 杯子里静止的球（命中之后显示） */
.ball-in-glass {
  position: absolute;
  bottom: 26px;                /* 在杯肚下半部分 */
  left: 50%;
  transform: translateX(-50%);
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: #ffcc00;
  box-shadow: 0 0 6px rgba(0,0,0,0.4);
  display: none;
  z-index: 3;                  /* 也在最前面 */
}

/* 右边队伍上方的烟花效果 */
/* 右边队伍上方的烟花效果（放大版） */
.fireworks {
  position: absolute;
  bottom: 260px;      /* 大致在 Cross team 上方，可再微调 */
  right: 50%;
  transform: translateX(50%);
  width: 220px;       /* 原来 140，放大区域 */
  height: 220px;
  pointer-events: none;
  display: none;      /* 默认不显示，胜利时再打开 */
}

/* 每一颗小火花（更大、更亮） */
.fireworks .spark {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 14px;        /* 原来 8px → 明显大 */
  height: 14px;
  margin: -7px 0 0 -7px;
  border-radius: 50%;
  opacity: 0;
  box-shadow: 0 0 10px rgba(0,0,0,0.4);
  animation: firework 1.2s ease-out infinite;  /* 时间稍微长一点 */
  animation-play-state: paused;
}

/* 激活状态：开始播放动画 */
.fireworks.active .spark {
  animation-play-state: running;
}

/* 爆炸轨迹：飞得更远一些 */
@keyframes firework {
  0% {
    transform: translate(0, 0) scale(0.4);
    opacity: 1;
  }
  100% {
    transform: translate(var(--x), var(--y)) scale(1.2);
    opacity: 0;
  }
}

/* 八个方向、距离加大，颜色保留多彩 */
.fireworks .s1 {
  --x: 0px;
  --y: -90px;          /* 原来 60 → 90，更远 */
  background: #ffcc00;
  animation-delay: 0s;
}
.fireworks .s2 {
  --x: 65px;
  --y: -65px;
  background: #ff4081;
  animation-delay: 0.1s;
}
.fireworks .s3 {
  --x: 95px;
  --y: 0px;
  background: #40c4ff;
  animation-delay: 0.2s;
}
.fireworks .s4 {
  --x: 65px;
  --y: 65px;
  background: #69f0ae;
  animation-delay: 0.3s;
}
.fireworks .s5 {
  --x: 0px;
  --y: 90px;
  background: #ffeb3b;
  animation-delay: 0.15s;
}
.fireworks .s6 {
  --x: -65px;
  --y: 65px;
  background: #ff6e40;
  animation-delay: 0.25s;
}
.fireworks .s7 {
  --x: -95px;
  --y: 0px;
  background: #b388ff;
  animation-delay: 0.35s;
}
.fireworks .s8 {
  --x: -65px;
  --y: -65px;
  background: #f06292;
  animation-delay: 0.05s;
}

/* 其他关于 .ball.show、.ball.hit/.miss 和 @keyframes 保持你原来的即可 */


    /* Hit / miss animations: always bounce on the table first */

    /* Left side hit: from outside → over table → bounce → into glass */
@keyframes throw-hit-left {
  0%   { left: 5%;  bottom: 210px; }
  25%  { left: 30%; bottom: 260px; }  /* 飞行更高一点 */
  55%  { left: 50%; bottom: 120px; }  /* 碰到桌面 */
  75%  { left: 63%; bottom: 240px; }  /* ★ 反弹更高的位置 */
  100% { left: 74%; bottom: 185px; }  /* 落入杯子 */
}


    /* Left side miss */
    @keyframes throw-miss-left {
      0%   { left: 5%;  bottom: 210px; }
      30%  { left: 30%; bottom: 250px; }
      60%  { left: 50%; bottom: 120px; }
      100% { left: 95%; bottom: 60px; }   /* off the table */
    }

    /* Right side hit */
@keyframes throw-hit-right {
  0%   { right: 5%;  bottom: 210px; }
  25%  { right: 30%; bottom: 260px; }
  55%  { right: 50%; bottom: 120px; }
  75%  { right: 63%; bottom: 240px; }  /* ★ 更高反弹 */
  100% { right: 74%; bottom: 185px; }
}


    /* Right side miss */
    @keyframes throw-miss-right {
      0%   { right: 5%;  bottom: 210px; }
      30%  { right: 30%; bottom: 250px; }
      60%  { right: 50%; bottom: 120px; }
      100% { right: 95%; bottom: 60px; }
    }

    .ball.show {
      display: block;
    }

    .side-left .ball.hit {
      animation: throw-hit-left 1.2s ease-out forwards;
    }

    .side-left .ball.miss {
      animation: throw-miss-left 1.2s ease-out forwards;
    }

    .side-right .ball.hit {
      animation: throw-hit-right 1.2s ease-out forwards;
    }

    .side-right .ball.miss {
      animation: throw-miss-right 1.2s ease-out forwards;
    }

    /* Center tic-tac-toe board */
    .board-wrapper {
      width: 260px;
      height: 260px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .board {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(3, 1fr);
      width: 240px;
      height: 240px;
      background: #fafafa;
      border-radius: 16px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.15);
      overflow: hidden;
    }

    .cell {
      border: 1px solid #ccc;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 40px;
      font-weight: 700;
      color: #333;
      position: relative;
    }

    .cell.highlight {
      background: #ffe9a3;
      box-shadow: inset 0 0 0 2px #ffb300;
    }

    .cell-label {
      position: absolute;
      font-size: 10px;
      color: #999;
      top: 4px;
      left: 6px;
    }

    /* Bottom info and controls */
    .info-panel {
      width: 90%;
      max-width: 1100px;
      margin: 8px auto 16px;
      font-size: 14px;
      color: #333;
      display: flex;
      flex-direction: column;
      gap: 4px;
      text-align: center;
    }

    .step-text {
      padding: 4px 0;
      background: transparent;
      border-radius: 0;
      box-shadow: none;
      min-height: 0;
      font-size: 18px;
      font-weight: 500;
    }

 .status-text {
      display: none;   /* 隐藏整行“Current step …” */
}

    .controls {
      margin-top: 6px;
    }

    button {
      padding: 6px 12px;
      border-radius: 16px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      background: #1976d2;
      color: #fff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      margin: 0 6px;
    }

    button:disabled {
      opacity: 0.5;
      cursor: default;
      box-shadow: none;
    }
  </style>
</head>
<body>
  <h1>Ping-Pong Tic-Tac-Toe</h1>

  <div class="stage">
    <!-- Left team -->
    <div class="side side-left">
      <div class="team-label team-left">Circle team (O)</div>
      <div class="table"></div>
      <div class="glass">
        <div class="ball-in-glass" id="ball-in-glass-left"></div>
      </div>
      <div class="ball" id="ball-left"></div>
    </div>

    <!-- Center tic-tac-toe board -->
    <div class="board-wrapper">
      <div class="board" id="board">
        <!-- Cells 1–9, left-to-right, top-to-bottom -->
        <div class="cell" data-pos="1"><span class="cell-label">1</span></div>
        <div class="cell" data-pos="2"><span class="cell-label">2</span></div>
        <div class="cell" data-pos="3"><span class="cell-label">3</span></div>
        <div class="cell" data-pos="4"><span class="cell-label">4</span></div>
        <div class="cell" data-pos="5"><span class="cell-label">5</span></div>
        <div class="cell" data-pos="6"><span class="cell-label">6</span></div>
        <div class="cell" data-pos="7"><span class="cell-label">7</span></div>
        <div class="cell" data-pos="8"><span class="cell-label">8</span></div>
        <div class="cell" data-pos="9"><span class="cell-label">9</span></div>
      </div>
    </div>

    <!-- Right team -->
    <div class="side side-right">
      <div class="team-label team-right">Cross team (X)</div>
      <div class="table"></div>
      <div class="glass">
        <div class="ball-in-glass" id="ball-in-glass-right"></div>
      </div>
      <div class="ball" id="ball-right"></div>
  <div class="fireworks" id="fireworks-right">           <!-- ★ 新增 -->
    <div class="spark s1"></div>
    <div class="spark s2"></div>
    <div class="spark s3"></div>
    <div class="spark s4"></div>
    <div class="spark s5"></div>
    <div class="spark s6"></div>
    <div class="spark s7"></div>
    <div class="spark s8"></div>
  </div>                                                 <!-- ★ 新增 -->
</div>  <!-- H，side-right 的结束标签 -->
    </div>
  </div>

  <div class="info-panel">
    <div class="step-text" id="step-text">Click “Start demo” and then use “Next step” to walk through the game.</div>
    <div class="status-text" id="status-text"></div>
    <div class="controls">
      <button id="start-btn">Start demo</button>
      <button id="next-btn" disabled>Next step</button>
    </div>
  </div>

  <script>
    // Sequence of steps, based on your description.
    // Convention: left team = O, right team = X.
    const steps = [
      {
        team: "left",
        result: "miss",
        type: "none",
        text: "The left team throws the ball. It bounces on the table but misses the glass, so they may NOT place a marker on the board."
      },
      {
        team: "right",
        result: "hit",
        type: "place",
        to: 5,
        mark: "X",
        text: "The right team throws the ball. It bounces on the table and lands in their wine glass, so they place an X in position 5."
      },
      {
        team: "left",
        result: "hit",
        type: "place",
        to: 1,
        mark: "O",
        text: "The left team hits the glass, so they place an O in position 1."
      },
      {
        team: "right",
        result: "hit",
        type: "place",
        to: 2,
        mark: "X",
        text: "The right team hits again and places an X in position 2."
      },
      {
        team: "left",
        result: "hit",
        type: "place",
        to: 8,
        mark: "O",
        text: "The left team hits and places an O in position 8."
      },
      {
        team: "right",
        result: "hit",
        type: "place",
        to: 4,
        mark: "X",
        text: "The right team hits and places an X in position 4."
      },
      {
        team: "left",
        result: "hit",
        type: "place",
        to: 6,
        mark: "O",
        text: "The left team hits and places an O in position 6."
      },
      {
        team: "right",
        result: "hit",
        type: "move",
        from: 2,
        to: 3,
        mark: "X",
        text: "The right team hits again. Because they already have three X markers on the board, they move the X from position 2 to 3."
      },
      {
        team: "left",
        result: "miss",
        type: "none",
        text: "The left team misses the glass, so they are not allowed to move any of their O markers."
      },
      {
        team: "right",
        result: "hit",
        type: "move",
        from: 4,
        to: 7,
        mark: "X",
        text: "The right team hits the glass and moves the X from position 4 to position 7. Now X has a line (3–5–7) and the right team wins."
      }
    ];

    const boardEl = document.getElementById("board");
    const cells = boardEl.querySelectorAll(".cell");
    const stepTextEl = document.getElementById("step-text");
    const statusTextEl = document.getElementById("status-text");
    const startBtn = document.getElementById("start-btn");
    const nextBtn = document.getElementById("next-btn");
    const ballLeft = document.getElementById("ball-left");
    const ballRight = document.getElementById("ball-right");
    const ballInGlassLeft = document.getElementById("ball-in-glass-left");
    const ballInGlassRight = document.getElementById("ball-in-glass-right");
const fireworksRight = document.getElementById("fireworks-right"); // ⭐ 新增


    let currentStep = 0;
    let animating = false;

    function clearBoard() {
      cells.forEach(cell => {
        cell.textContent = "";
        const label = document.createElement("span");
        label.className = "cell-label";
        label.textContent = cell.getAttribute("data-pos");
        cell.classList.remove("highlight");
        cell.appendChild(label);
      });
    }

    function getCell(pos) {
      return boardEl.querySelector('.cell[data-pos="' + pos + '"]');
    }

    function highlightCells(positions) {
      cells.forEach(cell => cell.classList.remove("highlight"));
      positions.forEach(p => {
        const c = getCell(p);
        if (c) c.classList.add("highlight");
      });
    }

    function resetBalls() {
      [ballLeft, ballRight].forEach(ball => {
        ball.classList.remove("show", "hit", "miss");
        ball.style.display = "none";
        void ball.offsetWidth; // force reflow to reset animations
      });
    }

    function clearBallsInGlass() {
      ballInGlassLeft.style.display = "none";
      ballInGlassRight.style.display = "none";
    }

    function showBallInGlass(team) {
      if (team === "left") {
        ballInGlassLeft.style.display = "block";
      } else {
        ballInGlassRight.style.display = "block";
      }
    }

function showBallInGlass(team) {
  if (team === "left") {
    ballInGlassLeft.style.display = "block";
  } else {
    ballInGlassRight.style.display = "block";
  }
}

/* ⭐ 在这里插入：烟花函数 */
function triggerFireworks() {
  if (!fireworksRight) return;
  fireworksRight.style.display = "block";
  fireworksRight.classList.add("active");

  // 自动停止（可调）
  setTimeout(() => {
    fireworksRight.classList.remove("active");
    fireworksRight.style.display = "none";
  }, 3500);
}

function playCurrentStep() {
  if (animating) return;
  if (currentStep >= steps.length) {
    statusTextEl.textContent =
      "Demo finished: the right team (X) wins with a line of three (3–5–7).";
    highlightCells([3, 5, 7]);
    triggerFireworks();      // ⭐ 在这里放烟花
    nextBtn.disabled = true;
    return;
  }

      const step = steps[currentStep];
      animating = true;
      stepTextEl.textContent = step.text;
      statusTextEl.textContent = `Current step: ${currentStep + 1} / ${steps.length}`;

      // New throw starts: remove any previous ball in the glass
      clearBallsInGlass();
      // Reset flying balls and then start a new animation
      resetBalls();

      const isLeft = step.team === "left";
      const ball = isLeft ? ballLeft : ballRight;

      // Show the flying ball and trigger the animation
      ball.style.display = "block";
      ball.classList.add("show");
      ball.classList.add(step.result === "hit" ? "hit" : "miss");

      const animationTime = 1300; // ms

      setTimeout(() => {
        if (step.result === "hit") {
          // After a successful throw: show ball in the glass,
          // and hide the flying ball so there is only ONE ball.
          showBallInGlass(step.team);
          ball.classList.remove("show", "hit", "miss");
          ball.style.display = "none";

          if (step.type === "place") {
            const cell = getCell(step.to);
            if (cell) {
              cell.textContent = step.mark;
            }
            highlightCells([step.to]);
          } else if (step.type === "move") {
            const fromCell = getCell(step.from);
            const toCell = getCell(step.to);
            if (fromCell && toCell) {
              fromCell.textContent = "";
              toCell.textContent = step.mark;
              highlightCells([step.from, step.to]);
            }
          }
        } else {
          // Miss: flying ball will just finish its path and then be cleared on the next step
          highlightCells([]);
        }

        animating = false;
        currentStep += 1;

        if (currentStep >= steps.length) {
          statusTextEl.textContent = "Demo finished: click “Start demo” to restart.";
        }
      }, animationTime);
    }

    startBtn.addEventListener("click", () => {
      clearBoard();
      highlightCells([]);
      resetBalls();
      clearBallsInGlass();
      currentStep = 0;
      animating = false;
      stepTextEl.textContent = "Ready. Click “Next step” to play step 1.";
      statusTextEl.textContent = "";
      nextBtn.disabled = false;
    });

    nextBtn.addEventListener("click", () => {
      playCurrentStep();
    });

    // Initial state
    clearBoard();
  </script>
</body>
</html>
